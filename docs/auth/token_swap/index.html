<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.56">
<title data-react-helmet="true">Token Swap | SpotifyAPI-NET</title><meta data-react-helmet="true" name="docsearch:version" content="5.1.1"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Token Swap | SpotifyAPI-NET"><meta data-react-helmet="true" name="description" content="This way uses server-side code or at least access to an exchange server, otherwise, compared to other"><meta data-react-helmet="true" property="og:description" content="This way uses server-side code or at least access to an exchange server, otherwise, compared to other"><meta data-react-helmet="true" property="og:url" content="https://johnnycrazy.github.io/SpotifyAPI-NET/docs/auth/token_swap"><link data-react-helmet="true" rel="shortcut icon" href="/SpotifyAPI-NET/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://johnnycrazy.github.io/SpotifyAPI-NET/docs/auth/token_swap"><link rel="stylesheet" href="/SpotifyAPI-NET/styles.8a053330.css">
<link rel="preload" href="/SpotifyAPI-NET/styles.c98ed224.js" as="script">
<link rel="preload" href="/SpotifyAPI-NET/runtime~main.2f8f7ee6.js" as="script">
<link rel="preload" href="/SpotifyAPI-NET/main.f44004eb.js" as="script">
<link rel="preload" href="/SpotifyAPI-NET/1.93fdc54d.js" as="script">
<link rel="preload" href="/SpotifyAPI-NET/2.1ac78bee.js" as="script">
<link rel="preload" href="/SpotifyAPI-NET/3.211279ce.js" as="script">
<link rel="preload" href="/SpotifyAPI-NET/1be78505.89b0a17b.js" as="script">
<link rel="preload" href="/SpotifyAPI-NET/3d0d8a2f.6e650079.js" as="script">
<link rel="preload" href="/SpotifyAPI-NET/10f76bbd.e23699ca.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/SpotifyAPI-NET/"><img class="navbar__logo" src="/SpotifyAPI-NET/img/logo.svg" alt="SpotifyAPI-NET"><strong class="navbar__title">SpotifyAPI-NET</strong></a><div class="navbar__item dropdown dropdown--hoverable dropdown--left"><a activeclassname="navbar__link--active" class="navbar__item navbar__link">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/SpotifyAPI-NET/docs/next/introduction">Latest/Next</a></li><li><a class="dropdown__link" href="/SpotifyAPI-NET/docs/home">5.1.1</a></li></ul></div><a class="navbar__item navbar__link" href="/SpotifyAPI-NET/news">News</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/JohnnyCrazy/SpotifyAPI-NET" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/SpotifyAPI-NET/"><img class="navbar__logo" src="/SpotifyAPI-NET/img/logo.svg" alt="SpotifyAPI-NET"><strong class="navbar__title">SpotifyAPI-NET</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a activeclassname="navbar__link--active" class="menu__link menu__link--sublist">Docs</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/SpotifyAPI-NET/docs/next/introduction">Latest/Next</a></li><li class="menu__list-item"><a class="menu__link" href="/SpotifyAPI-NET/docs/home">5.1.1</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/SpotifyAPI-NET/news">News</a></li><li class="menu__list-item"><a href="https://github.com/JohnnyCrazy/SpotifyAPI-NET" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SpotifyAPI-NET</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SpotifyAPI-NET/docs/home">Home</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">SpotifyAPI-NET.Web</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SpotifyAPI-NET/docs/web/getting_started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SpotifyAPI-NET/docs/web/albums">Albums</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SpotifyAPI-NET/docs/web/artists">Artists</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SpotifyAPI-NET/docs/web/browse">Browse</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SpotifyAPI-NET/docs/web/follow">Follow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SpotifyAPI-NET/docs/web/library">Library</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SpotifyAPI-NET/docs/web/personalization">Personalization</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SpotifyAPI-NET/docs/web/player">Player</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SpotifyAPI-NET/docs/web/playlists">Playlists</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SpotifyAPI-NET/docs/web/profiles">Profiles</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SpotifyAPI-NET/docs/web/proxy">Proxy Settings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SpotifyAPI-NET/docs/web/search">Search</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SpotifyAPI-NET/docs/web/tracks">Tracks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/SpotifyAPI-NET/docs/web/utilities">Utilities</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">SpotifyAPI-NET.Auth</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SpotifyAPI-NET/docs/auth/getting_started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SpotifyAPI-NET/docs/auth/implicit_grant">Implicit Grant</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SpotifyAPI-NET/docs/auth/authorization_code">Authorization Code</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/SpotifyAPI-NET/docs/auth/client_credentials">Client Credentials</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/SpotifyAPI-NET/docs/auth/token_swap">Token Swap</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="container padding-vert--lg docItemWrapper_1cc7"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><div><span class="badge badge--secondary">Version: 5.1.1</span></div><header><h1 class="docTitle_1vWb">Token Swap</h1></header><div class="markdown"><p>This way uses server-side code or at least access to an exchange server, otherwise, compared to other
methods, it is impossible to use.</p><p>With this approach, you provide the URI/URL to your desired exchange server to perform all necessary
requests to Spotify, as well as requests that return back to the &quot;server URI&quot;.</p><p>The exchange server <strong>must</strong> be able to:</p><ul><li>Return the authorization code from Spotify API authenticate page via GET request to the &quot;server URI&quot;.</li><li>Request the token response object via POST to the Spotify API token page.</li><li>Request a refreshed token response object via POST to the Spotify API token page.</li></ul><p><strong>The good news is that you do not need to code it yourself.</strong></p><p>The advantages of this method are that the client ID and redirect URI are very well hidden and almost unexposed, but more importantly, your client secret is <strong>never</strong> exposed and is completely hidden compared to other methods (excluding <a href="/SpotifyWebAPI/auth#implicitgrantauth">ImplicitGrantAuth</a>
as it does not deal with a client secret). This means
your Spotify app <strong>cannot</strong> be spoofed by a malicious third party.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="using-tokenswapwebapifactory"></a>Using TokenSwapWebAPIFactory<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-tokenswapwebapifactory" title="Direct link to heading">#</a></h2><p>The TokenSwapWebAPIFactory will create and configure a SpotifyWebAPI object for you.</p><p>It does this through the method GetWebApiAsync <strong>asynchronously</strong>, which means it will not halt execution of your program while obtaining it for you. If you would like to halt execution, which is <strong>synchronous</strong>, use <code>GetWebApiAsync().Result</code> without using <strong>await</strong>.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-csharp codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">TokenSwapWebAPIFactory webApiFactory;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">SpotifyWebAPI spotify;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// You should store a reference to WebAPIFactory if you are using AutoRefresh or want to manually refresh it later on. New WebAPIFactory objects cannot refresh SpotifyWebAPI object that they did not give to you.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">webApiFactory = new TokenSwapWebAPIFactory(&quot;INSERT LINK TO YOUR index.php HERE&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    Scope = Scope.UserReadPrivate | Scope.UserReadEmail | Scope.PlaylistReadPrivate,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    AutoRefresh = true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// You may want to react to being able to use the Spotify service.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// webApiFactory.OnAuthSuccess += (sender, e) =&gt; authorized = true;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// You may want to react to your user&#x27;s access expiring.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// webApiFactory.OnAccessTokenExpired += (sender, e) =&gt; authorized = false;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">try</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spotify = await webApiFactory.GetWebApiAsync();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Synchronous way:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // spotify = webApiFactory.GetWebApiAsync().Result;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">catch (Exception ex)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Example way to handle error reporting gracefully with your SpotifyWebAPI wrapper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // UpdateStatus($&quot;Spotify failed to load: {ex.Message}&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="using-tokenswapauth"></a>Using TokenSwapAuth<a aria-hidden="true" tabindex="-1" class="hash-link" href="#using-tokenswapauth" title="Direct link to heading">#</a></h2><p>Since the TokenSwapWebAPIFactory not only simplifies the whole process but offers additional functionality too
(such as AutoRefresh and AuthSuccess AuthFailure events), use of this way is very verbose and is only
recommended if you are having issues with TokenSwapWebAPIFactory or need access to the tokens.</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-csharp codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">TokenSwapAuth auth = new TokenSwapAuth(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    exchangeServerUri: &quot;INSERT LINK TO YOUR index.php HERE&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    serverUri: &quot;http://localhost:4002&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    scope: Scope.UserReadPrivate | Scope.UserReadEmail | Scope.PlaylistReadPrivate</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">auth.AuthReceived += async (sender, response) =&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    lastToken = await auth.ExchangeCodeAsync(response.Code);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    spotify = new SpotifyWebAPI()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        TokenType = lastToken.TokenType,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        AccessToken = lastToken.AccessToken</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    authenticated = true;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    auth.Stop();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">};</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">auth.OnAccessTokenExpired += async (sender, e) =&gt; spotify.AccessToken = (await auth.RefreshAuthAsync(lastToken.RefreshToken)).AccessToken;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">auth.Start();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">auth.OpenBrowser();</span></div></div></div></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="token-swap-endpoint"></a>Token Swap Endpoint<a aria-hidden="true" tabindex="-1" class="hash-link" href="#token-swap-endpoint" title="Direct link to heading">#</a></h2><p>To keep your client secret completely secure and your client ID and redirect URI as secure as possible, use of a web server (such as a php website) is required.</p><p>To use this method, an external HTTP Server (that you may need to create) needs to be able to supply the following HTTP Endpoints to your application:</p><p><code>/swap</code> - Swaps out an <code>authorization_code</code> with an <code>access_token</code> and <code>refresh_token</code> - The following parameters are required in the JSON POST Body:</p><ul><li><code>grant_type</code> (set to <code>&quot;authorization_code&quot;</code>)</li><li><code>code</code> (the <code>authorization_code</code>)</li><li><code>redirect_uri</code></li><li><ul><li><strong>Important</strong> The page that the redirect URI links to must return the authorization code json to your <code>serverUri</code> (default is &#x27;http://localhost:4002&#x27;) but to the folder &#x27;auth&#x27;, like this: &#x27;http://localhost:4002/auth&#x27;.</li></ul></li></ul><p><code>/refresh</code> - Refreshes an <code>access_token</code> - The following parameters are required in the JSON POST Body:</p><ul><li><code>grant_type</code> (set to <code>&quot;refresh_token&quot;</code>)</li><li><code>refresh_token</code></li></ul><p>The following open-source token swap endpoint code can be used for your website:</p><ul><li><a href="https://github.com/rollersteaam/spotify-token-swap-php" target="_blank" rel="noopener noreferrer">rollersteaam/spotify-token-swap-php</a></li><li><a href="https://github.com/simontaen/SpotifyTokenSwap" target="_blank" rel="noopener noreferrer">simontaen/SpotifyTokenSwap</a></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="remarks"></a>Remarks<a aria-hidden="true" tabindex="-1" class="hash-link" href="#remarks" title="Direct link to heading">#</a></h2><p>It should be noted that GitHub Pages does not support hosting php scripts. Hosting php scripts through it will cause the php to render as plain HTML, potentially compromising your client secret while doing absolutely nothing.</p><p>Be sure you have whitelisted your redirect uri in the Spotify Developer Dashboard otherwise the authorization will always fail.</p><p>If you did not use the WebAPIFactory or you provided a <code>serverUri</code> different from its default, you must make sure your redirect uri&#x27;s script at your endpoint will properly redirect to your <code>serverUri</code> (such as changing the areas which refer to <code>localhost:4002</code> if you had changed <code>serverUri</code> from its default), otherwise it will never reach your new <code>serverUri</code>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/JohnnyCrazy/SpotifyAPI-NET/edit/master/SpotifyAPI.Docs/versioned_docs/version-5.1.1/auth/token_swap.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col text--right"><em><small>Last updated on <time datetime="2020-06-04T16:34:19.000Z" class="docLastUpdatedAt_1sqk">6/4/2020</time> by <strong>Jonas Dellinger</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/SpotifyAPI-NET/docs/auth/client_credentials"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Client Credentials</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#using-tokenswapwebapifactory" class="table-of-contents__link">Using TokenSwapWebAPIFactory</a></li><li><a href="#using-tokenswapauth" class="table-of-contents__link">Using TokenSwapAuth</a></li><li><a href="#token-swap-endpoint" class="table-of-contents__link">Token Swap Endpoint</a></li><li><a href="#remarks" class="table-of-contents__link">Remarks</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>Copyright © 2020 Jonas Dellinger. Built with Docusaurus.</div></div></div></footer></div>
<script src="/SpotifyAPI-NET/styles.c98ed224.js"></script>
<script src="/SpotifyAPI-NET/runtime~main.2f8f7ee6.js"></script>
<script src="/SpotifyAPI-NET/main.f44004eb.js"></script>
<script src="/SpotifyAPI-NET/1.93fdc54d.js"></script>
<script src="/SpotifyAPI-NET/2.1ac78bee.js"></script>
<script src="/SpotifyAPI-NET/3.211279ce.js"></script>
<script src="/SpotifyAPI-NET/1be78505.89b0a17b.js"></script>
<script src="/SpotifyAPI-NET/3d0d8a2f.6e650079.js"></script>
<script src="/SpotifyAPI-NET/10f76bbd.e23699ca.js"></script>
</body>
</html>